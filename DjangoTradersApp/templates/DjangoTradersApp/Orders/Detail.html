{% extends "DjangoTradersApp/base.html" %}

{% block title %}Order #{{ order.order_id }} - Django Traders{% endblock %}

{% block content %}
<div class="container mt-4">

    <!-- Order Header Card -->
    <div class="card mx-auto shadow-lg mb-4" style="max-width: 1200px;">
        <div style="background: linear-gradient(135deg, #0A2240 0%, #1C3A5F 100%); padding: 20px; border-radius: 10px 10px 0 0;">
            <div class="d-flex justify-content-between align-items-center">
                <h2 class="mb-0 text-white">
                    <i class="fas fa-receipt"></i> Order #{{ order.order_id }}
                </h2>
                {% if order.shipped_date %}
                    <span class="badge bg-success fs-6">
                        <i class="fas fa-check-circle"></i> Shipped
                    </span>
                {% else %}
                    <span class="badge bg-warning text-dark fs-6">
                        <i class="fas fa-clock"></i> Processing
                    </span>
                {% endif %}
            </div>
        </div>

        <div class="card-body p-4">
            <div class="row">
                <!-- Order Information Column -->
                <div class="col-md-6">
                    <h5 class="icon-navy mb-3">
                        <i class="fas fa-info-circle"></i> Order Information
                    </h5>
                    <table class="table table-borderless">
                        <tbody>
                            <tr>
                                <th scope="row" style="width: 45%;">
                                    <i class="fas fa-hashtag icon-gold"></i> Order ID
                                </th>
                                <td><strong>{{ order.order_id }}</strong></td>
                            </tr>
                            <tr>
                                <th scope="row">
                                    <i class="fas fa-building icon-gold"></i> Customer
                                </th>
                                <td>
                                    <a href="{% url 'DjTraders.CustomerDetail' customer_id=order.customer.customer_id %}" 
                                       class="text-decoration-none">
                                        <strong>{{ order.customer.company_name }}</strong>
                                    </a>
                                </td>
                            </tr>
                            <tr>
                                <th scope="row">
                                    <i class="fas fa-calendar-plus icon-gold"></i> Order Date
                                </th>
                                <td>
                                    {% if order.order_date %}
                                        {{ order.order_date|date:"F d, Y" }}
                                    {% else %}
                                        <span class="text-muted">N/A</span>
                                    {% endif %}
                                </td>
                            </tr>
                            <tr>
                                <th scope="row">
                                    <i class="fas fa-calendar-check icon-gold"></i> Required Date
                                </th>
                                <td>
                                    {% if order.required_date %}
                                        {{ order.required_date|date:"F d, Y" }}
                                    {% else %}
                                        <span class="text-muted">N/A</span>
                                    {% endif %}
                                </td>
                            </tr>
                            <tr>
                                <th scope="row">
                                    <i class="fas fa-shipping-fast icon-gold"></i> Shipped Date
                                </th>
                                <td>
                                    {% if order.shipped_date %}
                                        {{ order.shipped_date|date:"F d, Y" }}
                                    {% else %}
                                        <span class="badge bg-warning text-dark">Pending</span>
                                    {% endif %}
                                </td>
                            </tr>
                            <tr>
                                <th scope="row">
                                    <i class="fas fa-truck icon-gold"></i> Ship Via
                                </th>
                                <td>
                                    {% if order.ship_via %}
                                        {{ order.ship_via }}
                                    {% else %}
                                        <span class="text-muted">N/A</span>
                                    {% endif %}
                                </td>
                            </tr>
                            <tr>
                                <th scope="row">
                                    <i class="fas fa-dollar-sign icon-gold"></i> Freight Cost
                                </th>
                                <td>
                                    <strong class="text-success">
                                        ${{ order.freight|floatformat:2|default:"0.00" }}
                                    </strong>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>

                <!-- Shipping Information Column -->
                <div class="col-md-6">
                    <h5 class="icon-navy mb-3">
                        <i class="fas fa-map-marked-alt"></i> Shipping Information
                    </h5>
                    <table class="table table-borderless">
                        <tbody>
                            <tr>
                                <th scope="row" style="width: 45%;">
                                    <i class="fas fa-user icon-gold"></i> Ship Name
                                </th>
                                <td>{{ order.ship_name|default:"N/A" }}</td>
                            </tr>
                            <tr>
                                <th scope="row">
                                    <i class="fas fa-road icon-gold"></i> Address
                                </th>
                                <td>{{ order.ship_address|default:"N/A" }}</td>
                            </tr>
                            <tr>
                                <th scope="row">
                                    <i class="fas fa-city icon-gold"></i> City
                                </th>
                                <td>{{ order.ship_city|default:"N/A" }}</td>
                            </tr>
                            <tr>
                                <th scope="row">
                                    <i class="fas fa-map icon-gold"></i> Region
                                </th>
                                <td>{{ order.ship_region|default:"N/A" }}</td>
                            </tr>
                            <tr>
                                <th scope="row">
                                    <i class="fas fa-mail-bulk icon-gold"></i> Postal Code
                                </th>
                                <td>{{ order.ship_postal_code|default:"N/A" }}</td>
                            </tr>
                            <tr>
                                <th scope="row">
                                    <i class="fas fa-globe icon-gold"></i> Country
                                </th>
                                <td>
                                    <span class="badge bg-info">
                                        {{ order.ship_country|default:"N/A" }}
                                    </span>
                                </td>
                            </tr>
                        </tbody>
                    </table>

                    <!-- Complete Shipping Address -->
                    {% if order.ship_address or order.ship_city %}
                    <div class="alert alert-light border mt-3">
                        <h6 class="icon-navy mb-2">
                            <i class="fas fa-envelope"></i> Complete Shipping Address
                        </h6>
                        <address class="mb-0" style="line-height: 1.8;">
                            {% if order.ship_name %}<strong>{{ order.ship_name }}</strong><br>{% endif %}
                            {% if order.ship_address %}{{ order.ship_address }}<br>{% endif %}
                            {% if order.ship_city %}{{ order.ship_city }}{% if order.ship_region %}, {{ order.ship_region }}{% endif %} {% if order.ship_postal_code %}{{ order.ship_postal_code }}{% endif %}<br>{% endif %}
                            {% if order.ship_country %}<strong>{{ order.ship_country }}</strong>{% endif %}
                        </address>
                    </div>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>

    <!-- Order Items Section - REQUIREMENT 3 -->
    <div class="card mx-auto shadow-lg mb-4" style="max-width: 1200px;">
        <div style="background: linear-gradient(135deg, #D4AF37 0%, #FFD700 100%); padding: 15px; border-radius: 10px 10px 0 0;">
            <div class="d-flex justify-content-between align-items-center">
                <h3 class="mb-0" style="color: #0A2240;">
                    <i class="fas fa-box-open"></i> Order Items
                </h3>
                <span class="badge bg-dark fs-6">
                    {{ order_details|length }} Item{{ order_details|length|pluralize }}
                </span>
            </div>
        </div>

        <div class="card-body p-0">
            {% if order_details %}
                <div class="table-responsive">
                    <table class="table table-hover table-striped mb-0">
                        <thead style="background: #0A2240; color: white;">
                            <tr>
                                <th>Product Name</th>
                                <th>Category</th>
                                <th class="text-center">Unit Price</th>
                                <th class="text-center">Quantity</th>
                                <th class="text-center">Discount</th>
                                <th class="text-end">Line Total</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for detail in order_details %}
                            <tr>
                                <td>
                                    <a href="{% url 'DjTraders.ProductDetail' product_id=detail.product.product_id %}" 
                                       class="text-decoration-none">
                                        <strong>{{ detail.product.product_name }}</strong>
                                    </a>
                                </td>
                                <td>
                                    {% if detail.product.category %}
                                        <span class="badge bg-info">
                                            {{ detail.product.category.category_name }}
                                        </span>
                                    {% else %}
                                        <span class="text-muted">N/A</span>
                                    {% endif %}
                                </td>
                                <td class="text-center">
                                    ${{ detail.unit_price|floatformat:2 }}
                                </td>
                                <td class="text-center">
                                    <span class="badge bg-secondary">
                                        {{ detail.quantity }}
                                    </span>
                                </td>
                                <td class="text-center">
                                    {% if detail.discount > 0 %}
                                        <span class="badge bg-danger">
                                            {{ detail.discount|floatformat:0 }}%
                                        </span>
                                    {% else %}
                                        <span class="text-muted">—</span>
                                    {% endif %}
                                </td>
                                <td class="text-end">
                                    <strong style="color: #0A2240;">
                                        ${{ detail.line_total|floatformat:2 }}
                                    </strong>
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                        <tfoot style="background: #f8f9fa;">
                            <tr>
                                <td colspan="5" class="text-end">
                                    <strong style="color: #0A2240; font-size: 1.1rem;">
                                        Subtotal:
                                    </strong>
                                </td>
                                <td class="text-end">
                                    <strong style="color: #0A2240; font-size: 1.1rem;">
                                        ${{ order_total|floatformat:2 }}
                                    </strong>
                                </td>
                            </tr>
                            <tr>
                                <td colspan="5" class="text-end">
                                    <strong style="color: #0A2240; font-size: 1.1rem;">
                                        Freight:
                                    </strong>
                                </td>
                                <td class="text-end">
                                    <strong style="color: #0A2240; font-size: 1.1rem;">
                                        ${{ order.freight|floatformat:2|default:"0.00" }}
                                    </strong>
                                </td>
                            </tr>
                            <tr style="background: #D4AF37;">
                                <td colspan="5" class="text-end">
                                    <strong style="color: #0A2240; font-size: 1.2rem;">
                                        GRAND TOTAL:
                                    </strong>
                                </td>
                                <td class="text-end">
                                    <strong style="color: #0A2240; font-size: 1.2rem;">
                                        {% widthratio order.freight 1 1 as freight_value %}
                                        ${{ order_total|add:order.freight|floatformat:2 }}
                                    </strong>
                                </td>
                            </tr>
                        </tfoot>
                    </table>
                </div>
            {% else %}
                <div class="alert alert-info m-3">
                    <i class="fas fa-info-circle"></i> 
                    No items found for this order.
                </div>
            {% endif %}
        </div>
    </div>

    <!-- Navigation -->
    <div class="mx-auto" style="max-width: 1200px;">
        <div class="d-flex justify-content-between">
            <a href="{% url 'DjTraders.CustomerDetail' customer_id=order.customer.customer_id %}" 
               class="btn btn-secondary">
                <i class="fas fa-arrow-left"></i> Back to Customer
            </a>
            <a href="{% url 'home' %}" class="btn btn-gold">
                <i class="fas fa-home"></i> Home
            </a>
        </div>
    </div>

</div>

<style>
    .table-borderless th {
        color: #0A2240;
        font-weight: 600;
    }
    
    .table-borderless td {
        padding-left: 10px;
    }
    
    .table-hover tbody tr:hover {
        background-color: #f8f9fa;
    }
    
    address {
        line-height: 1.8;
    }
    
    tfoot tr {
        font-weight: 500;
    }
</style>

{% endblock %}