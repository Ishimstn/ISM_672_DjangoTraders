
{% extends "base.html" %}

{% block content %}

<div class="container shadow-sm">

	<!-- Search Form -->
	<form method="GET" class="d-flex">
		<div class="navbar">

			<!-- Search Inputs -->
			<div class="nav">

				<!-- Search By Customer-->
				<div class="nav-item me-1">
					<input type="text"
							   name="customer"
							   class="form-control me-2"
							   placeholder="Search by customer..."
							   value="{{ search_customer }}">
				</div>
				
				<!--Added in search form element for title-->
				
				<!-- Search By Contact_Title-->
				<div class="nav-item me-1">
					<input type="text"
							   name="contact_title"
							   class="form-control me-2"
							   placeholder="Search by contact title..."
							   value="{{ search_contact_title }}">
				</div>

				
				<!-- Search By Contact-->
				<div class="nav-item-sm me-1">
					<input type="text"
						   name="contact"
						   class="form-control me-2"
						   placeholder="Search by contact..."
						   value="{{ search_contact }}">
				</div>
				
				<!-- Search By City-->
				<div class="nav-item me-1">
					<input type="text"
						   name="city"
						   class="form-control me-2"
						   placeholder="Search by city..."
						   value="{{ search_city }}">
				</div>

				<!-- Search By Country-->
				<div class="nav-item me-1">
					<select name="country" class="form-select me-2">
						<option value="">Select country...</option>
						{% for country in available_countries %}
							{% if country %}
								<option value="{{ country }}" {% if country == search_country %}selected{% endif %}>
									{{ country }}
								</option>
							{% endif %}
						{% endfor %}
					</select>
				</div>

				<!-- Search by Region-->
				<div class="nav-item me-1">
					<input type="text"
						   name="region"
						   class="form-control me-2"
						   placeholder="Search by region..."
						   value="{{ search_region }}">
				</div>
			</div>
			
			<!-- Search and Clear Buttons-->
			<div class="nav ms-2">
				<button type="submit" class="btn btn-light ">
					<i class="fa fa-search"></i>
				</button>
				<a href="{% url 'DjTraders.Customers' %}"
					class="btn btn-light ms-2">
					<i class="fa fa-times"></i>
				
				</a>
			</div>

		</div>
	</form>


	{% if customers %}

		<table class="table table-hover"
		   id="CustomersTable" width="100%">
		<thead>
			<!--Added in Sortable Headers-->
			<tr class="">
			
				<th class="my-2 text-center">
					<a href="?{% if query_string %}{{ query_string }}&{% endif %}sort=company_name&order={% if current_sort == 'company_name' and current_order == 'asc' %}desc{% else %}asc{% endif %}" class="text-dark text-decoration-none">
						Customer 
						{% if current_sort == 'company_name' %}
							<i class="fa fa-sort-{% if current_order == 'asc' %}up{% else %}down{% endif %}"></i>
						{% else %}
							<i class="fa fa-sort"></i>
						{% endif %}
					</a>
				</th>
				
			
				<th class="ps-1">
					<a href="?{% if query_string %}{{ query_string }}&{% endif %}sort=contact_name&order={% if current_sort == 'contact_name' and current_order == 'asc' %}desc{% else %}asc{% endif %}" class="text-dark text-decoration-none">
						Contact 
						{% if current_sort == 'contact_name' %}
							<i class="fa fa-sort-{% if current_order == 'asc' %}up{% else %}down{% endif %}"></i>
						{% else %}
							<i class="fa fa-sort"></i>
						{% endif %}
					</a>
				</th>
				
				
				<th>
					<a href="?{% if query_string %}{{ query_string }}&{% endif %}sort=contact_title&order={% if current_sort == 'contact_title' and current_order == 'asc' %}desc{% else %}asc{% endif %}" class="text-dark text-decoration-none">
						Title 
						{% if current_sort == 'contact_title' %}
							<i class="fa fa-sort-{% if current_order == 'asc' %}up{% else %}down{% endif %}"></i>
						{% else %}
							<i class="fa fa-sort"></i>
						{% endif %}
					</a>
				</th>
				
				<th class="text-center">Address</th>
				
				
				<th>
					<a href="?{% if query_string %}{{ query_string }}&{% endif %}sort=city&order={% if current_sort == 'city' and current_order == 'asc' %}desc{% else %}asc{% endif %}" class="text-dark text-decoration-none">
						City 
						{% if current_sort == 'city' %}
							<i class="fa fa-sort-{% if current_order == 'asc' %}up{% else %}down{% endif %}"></i>
						{% else %}
							<i class="fa fa-sort"></i>
						{% endif %}
					</a>
				</th>
				
				
				<th>
					<a href="?{% if query_string %}{{ query_string }}&{% endif %}sort=region&order={% if current_sort == 'region' and current_order == 'asc' %}desc{% else %}asc{% endif %}" class="text-dark text-decoration-none">
						Region 
						{% if current_sort == 'region' %}
							<i class="fa fa-sort-{% if current_order == 'asc' %}up{% else %}down{% endif %}"></i>
						{% else %}
							<i class="fa fa-sort"></i>
						{% endif %}
					</a>
				</th>
				
				
				<th class="px-2">
					<a href="?{% if query_string %}{{ query_string }}&{% endif %}sort=country&order={% if current_sort == 'country' and current_order == 'asc' %}desc{% else %}asc{% endif %}" class="text-dark text-decoration-none">
						Country 
						{% if current_sort == 'country' %}
							<i class="fa fa-sort-{% if current_order == 'asc' %}up{% else %}down{% endif %}"></i>
						{% else %}
							<i class="fa fa-sort"></i>
						{% endif %}
					</a>
				</th>
				
				<th>Details</th>
			</tr>
		</thead>

		<tbody class="small">

			{% for customer in customers %}
			<tr >
				<td class="p-2">{{customer.company_name}}</td>
				<td class="p-2">{{customer.contact_name}}</td>
				<!--Added in column to show title in the table-->
				<td class="p-2">{{customer.contact_title}}</td>
				<td class="p-2">{{customer.address}}</td>
				<td class="p-2">{{customer.city}}</td>
				<!--Added in region-->
				<td class="p-2">{{customer.region}}</td>
				<td class="p-2">{{customer.country}}</td>

				<td title="Click to see details" class="text-center">
					<a 	href = {% url 'DjTraders.CustomerDetail' customer_id=customer.customer_id %} class="">
						<i class="fa-solid fa-house-user fa-lg pt-2" style="color: steelblue;"></i>
					</a>
				</td>
			</tr>
			{% endfor %}
		</tbody>
	</table>	
	{% else %}
		<div class="alert alert-warning">
			{% if search_country %}
				No customers found for country "{{ search_country }}". 
				<a href="{% url 'DjTraders.Customers' %}">Show all customers</a>
			{% else %}
				No Customers Found
			{% endif %}
		</div>
	{% endif %}
</div>

<!--Initialize DataTables CDN through Index.html-->
<script type="text/javascript">
	$(document).ready(function() {
		$('#CustomersTable').DataTable({  
    	order:[0,'asc'],
    	responsive:true,
    	paging:true,
    	searching:false,
    	ordering: false,  
	});


	// Auto-submit when user types in text inputs
    $('input[type="text"]').on('input', function() {
        // Add small delay to prevent too many requests
        clearTimeout(window.searchTimeout);
        window.searchTimeout = setTimeout(function() {
            $('form').submit();
        }, 500); // Wait 500ms after user stops typing
    });
    
    // Auto-submit immediately when dropdown changes
    $('select').on('change', function() {
        $('form').submit();
    });

});
	</script>
	
{% endblock%}